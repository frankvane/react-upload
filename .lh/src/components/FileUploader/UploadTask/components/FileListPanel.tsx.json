{
    "sourceFile": "src/components/FileUploader/UploadTask/components/FileListPanel.tsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 26,
            "patches": [
                {
                    "date": 1748432685733,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1748433141660,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,117 @@\n+import { Button, Progress, Table, message } from \"antd\";\r\n+import React, { useEffect, useState } from \"react\";\r\n+import {\r\n+  clearAllFileMeta,\r\n+  getAllFileMeta,\r\n+  removeFileMeta,\r\n+} from \"../services/dbService\";\r\n+\r\n+import type { UploadFileMeta } from \"../types/file\";\r\n+\r\n+interface FileListPanelProps {\r\n+  progress?: number;\r\n+}\r\n+\r\n+const FileListPanel: React.FC<FileListPanelProps> = ({ progress }) => {\r\n+  const [files, setFiles] = useState<UploadFileMeta[]>([]);\r\n+  const [loading, setLoading] = useState(true);\r\n+\r\n+  const fetchFiles = async () => {\r\n+    setLoading(true);\r\n+    const all = await getAllFileMeta();\r\n+    setFiles(all);\r\n+    setLoading(false);\r\n+  };\r\n+\r\n+  useEffect(() => {\r\n+    fetchFiles();\r\n+  }, []);\r\n+\r\n+  // 进度变化时刷新\r\n+  useEffect(() => {\r\n+    if (progress === 100) fetchFiles();\r\n+  }, [progress]);\r\n+\r\n+  const handleRemove = async (key: string) => {\r\n+    await removeFileMeta(key);\r\n+    message.success(\"已删除\");\r\n+    fetchFiles();\r\n+  };\r\n+\r\n+  const handleClear = async () => {\r\n+    await clearAllFileMeta();\r\n+    message.success(\"已清空\");\r\n+    fetchFiles();\r\n+  };\r\n+\r\n+  const columns = [\r\n+    {\r\n+      title: \"文件名\",\r\n+      dataIndex: \"name\",\r\n+      key: \"name\",\r\n+      align: \"left\" as const,\r\n+      ellipsis: true,\r\n+    },\r\n+    {\r\n+      title: \"大小\",\r\n+      dataIndex: \"size\",\r\n+      key: \"size\",\r\n+      align: \"left\" as const,\r\n+      render: (size: number) => `${(size / 1024).toFixed(1)} KB`,\r\n+    },\r\n+    {\r\n+      title: \"类型\",\r\n+      dataIndex: \"type\",\r\n+      key: \"type\",\r\n+      align: \"left\" as const,\r\n+    },\r\n+    {\r\n+      title: \"操作时间\",\r\n+      dataIndex: \"addedAt\",\r\n+      key: \"addedAt\",\r\n+      align: \"left\" as const,\r\n+      render: (t: number) => new Date(t).toLocaleString(),\r\n+    },\r\n+    {\r\n+      title: \"操作\",\r\n+      key: \"action\",\r\n+      align: \"right\" as const,\r\n+      render: (_: any, record: UploadFileMeta) => (\r\n+        <Button danger size=\"small\" onClick={() => handleRemove(record.key)}>\r\n+          删除\r\n+        </Button>\r\n+      ),\r\n+    },\r\n+  ];\r\n+\r\n+  return (\r\n+    <div>\r\n+      <div style={{ marginBottom: 8, display: \"flex\", alignItems: \"center\" }}>\r\n+        <Button\r\n+          danger\r\n+          size=\"small\"\r\n+          onClick={handleClear}\r\n+          disabled={files.length === 0}\r\n+        >\r\n+          清空全部\r\n+        </Button>\r\n+        {typeof progress === \"number\" && progress < 100 && (\r\n+          <div style={{ marginLeft: 16, flex: 1 }}>\r\n+            <Progress percent={progress} size=\"small\" status=\"active\" />\r\n+          </div>\r\n+        )}\r\n+      </div>\r\n+      <Table\r\n+        columns={columns}\r\n+        dataSource={files}\r\n+        rowKey=\"key\"\r\n+        size=\"small\"\r\n+        loading={loading}\r\n+        pagination={false}\r\n+        locale={{ emptyText: \"暂无待上传文件\" }}\r\n+      />\r\n+    </div>\r\n+  );\r\n+};\r\n+\r\n+export default FileListPanel;\r\n"
                },
                {
                    "date": 1748433356442,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -9,11 +9,15 @@\n import type { UploadFileMeta } from \"../types/file\";\r\n \r\n interface FileListPanelProps {\r\n   progress?: number;\r\n+  costSeconds?: number;\r\n }\r\n \r\n-const FileListPanel: React.FC<FileListPanelProps> = ({ progress }) => {\r\n+const FileListPanel: React.FC<FileListPanelProps> = ({\r\n+  progress,\r\n+  costSeconds,\r\n+}) => {\r\n   const [files, setFiles] = useState<UploadFileMeta[]>([]);\r\n   const [loading, setLoading] = useState(true);\r\n \r\n   const fetchFiles = async () => {\r\n@@ -95,10 +99,27 @@\n         >\r\n           清空全部\r\n         </Button>\r\n         {typeof progress === \"number\" && progress < 100 && (\r\n-          <div style={{ marginLeft: 16, flex: 1 }}>\r\n-            <Progress percent={progress} size=\"small\" status=\"active\" />\r\n+          <div\r\n+            style={{\r\n+              marginLeft: 16,\r\n+              flex: 1,\r\n+              display: \"flex\",\r\n+              alignItems: \"center\",\r\n+            }}\r\n+          >\r\n+            <Progress\r\n+              percent={progress}\r\n+              size=\"small\"\r\n+              status=\"active\"\r\n+              style={{ flex: 1 }}\r\n+            />\r\n+            {typeof costSeconds === \"number\" && costSeconds > 0 && (\r\n+              <span style={{ marginLeft: 12, color: \"#888\" }}>\r\n+                用时 {costSeconds} 秒\r\n+              </span>\r\n+            )}\r\n           </div>\r\n         )}\r\n       </div>\r\n       <Table\r\n"
                },
                {
                    "date": 1748434220471,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -135,88 +135,4 @@\n   );\r\n };\r\n \r\n export default FileListPanel;\r\n-import { Button, List, Spin, Typography, message } from \"antd\";\r\n-import React, { useEffect, useState } from \"react\";\r\n-import {\r\n-  clearAllFileMeta,\r\n-  getAllFileMeta,\r\n-  removeFileMeta,\r\n-} from \"../services/dbService\";\r\n-\r\n-import type { UploadFileMeta } from \"../types/file\";\r\n-\r\n-const FileListPanel: React.FC = () => {\r\n-  const [files, setFiles] = useState<UploadFileMeta[]>([]);\r\n-  const [loading, setLoading] = useState(true);\r\n-\r\n-  const fetchFiles = async () => {\r\n-    setLoading(true);\r\n-    const all = await getAllFileMeta();\r\n-    setFiles(all);\r\n-    setLoading(false);\r\n-  };\r\n-\r\n-  useEffect(() => {\r\n-    fetchFiles();\r\n-  }, []);\r\n-\r\n-  const handleRemove = async (key: string) => {\r\n-    await removeFileMeta(key);\r\n-    message.success(\"已删除\");\r\n-    fetchFiles();\r\n-  };\r\n-\r\n-  const handleClear = async () => {\r\n-    await clearAllFileMeta();\r\n-    message.success(\"已清空\");\r\n-    fetchFiles();\r\n-  };\r\n-\r\n-  return (\r\n-    <div>\r\n-      <div style={{ marginBottom: 8 }}>\r\n-        <Button\r\n-          danger\r\n-          size=\"small\"\r\n-          onClick={handleClear}\r\n-          disabled={files.length === 0}\r\n-        >\r\n-          清空全部\r\n-        </Button>\r\n-      </div>\r\n-      {loading ? (\r\n-        <Spin />\r\n-      ) : (\r\n-        <List\r\n-          bordered\r\n-          size=\"small\"\r\n-          dataSource={files}\r\n-          locale={{ emptyText: \"暂无待上传文件\" }}\r\n-          renderItem={(item) => (\r\n-            <List.Item\r\n-              actions={[\r\n-                <Button\r\n-                  danger\r\n-                  size=\"small\"\r\n-                  onClick={() => handleRemove(item.key)}\r\n-                  key=\"remove\"\r\n-                >\r\n-                  删除\r\n-                </Button>,\r\n-              ]}\r\n-            >\r\n-              <Typography.Text>{item.name}</Typography.Text>\r\n-              <span style={{ marginLeft: 8, color: \"#888\" }}>\r\n-                {(item.size / 1024).toFixed(1)} KB\r\n-              </span>\r\n-              <span style={{ marginLeft: 8, color: \"#888\" }}>{item.type}</span>\r\n-            </List.Item>\r\n-          )}\r\n-        />\r\n-      )}\r\n-    </div>\r\n-  );\r\n-};\r\n-\r\n-export default FileListPanel;\r\n"
                },
                {
                    "date": 1748435277717,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -35,12 +35,14 @@\n   useEffect(() => {\r\n     if (progress === 100) fetchFiles();\r\n   }, [progress]);\r\n \r\n+  // 优化：本地先删，UI立刻响应\r\n   const handleRemove = async (key: string) => {\r\n+    setFiles((prev) => prev.filter((item) => item.key !== key));\r\n     await removeFileMeta(key);\r\n     message.success(\"已删除\");\r\n-    fetchFiles();\r\n+    // 不再fetchFiles\r\n   };\r\n \r\n   const handleClear = async () => {\r\n     await clearAllFileMeta();\r\n@@ -79,9 +81,9 @@\n     {\r\n       title: \"操作\",\r\n       key: \"action\",\r\n       align: \"right\" as const,\r\n-      render: (_: any, record: UploadFileMeta) => (\r\n+      render: (_: unknown, record: UploadFileMeta) => (\r\n         <Button danger size=\"small\" onClick={() => handleRemove(record.key)}>\r\n           删除\r\n         </Button>\r\n       ),\r\n"
                },
                {
                    "date": 1748435347753,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -51,8 +51,15 @@\n   };\r\n \r\n   const columns = [\r\n     {\r\n+      title: \"序号\",\r\n+      key: \"index\",\r\n+      align: \"left\" as const,\r\n+      width: 60,\r\n+      render: (_: any, __: UploadFileMeta, idx: number) => idx + 1,\r\n+    },\r\n+    {\r\n       title: \"文件名\",\r\n       dataIndex: \"name\",\r\n       key: \"name\",\r\n       align: \"left\" as const,\r\n"
                },
                {
                    "date": 1748435406753,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -18,8 +18,9 @@\n   costSeconds,\r\n }) => {\r\n   const [files, setFiles] = useState<UploadFileMeta[]>([]);\r\n   const [loading, setLoading] = useState(true);\r\n+  const [selectedRowKeys, setSelectedRowKeys] = useState<React.Key[]>([]);\r\n \r\n   const fetchFiles = async () => {\r\n     setLoading(true);\r\n     const all = await getAllFileMeta();\r\n@@ -49,8 +50,26 @@\n     message.success(\"已清空\");\r\n     fetchFiles();\r\n   };\r\n \r\n+  // 批量删除\r\n+  const handleBatchDelete = async () => {\r\n+    if (selectedRowKeys.length === 0) return;\r\n+    setFiles((prev) =>\r\n+      prev.filter((item) => !selectedRowKeys.includes(item.key))\r\n+    );\r\n+    await Promise.all(\r\n+      selectedRowKeys.map((key) => removeFileMeta(key as string))\r\n+    );\r\n+    setSelectedRowKeys([]);\r\n+    message.success(\"批量删除成功\");\r\n+  };\r\n+\r\n+  const rowSelection = {\r\n+    selectedRowKeys,\r\n+    onChange: (keys: React.Key[]) => setSelectedRowKeys(keys),\r\n+  };\r\n+\r\n   const columns = [\r\n     {\r\n       title: \"序号\",\r\n       key: \"index\",\r\n@@ -107,8 +126,17 @@\n           disabled={files.length === 0}\r\n         >\r\n           清空全部\r\n         </Button>\r\n+        <Button\r\n+          danger\r\n+          size=\"small\"\r\n+          style={{ marginLeft: 8 }}\r\n+          onClick={handleBatchDelete}\r\n+          disabled={selectedRowKeys.length === 0}\r\n+        >\r\n+          批量删除\r\n+        </Button>\r\n         {typeof progress === \"number\" && progress < 100 && (\r\n           <div\r\n             style={{\r\n               marginLeft: 16,\r\n@@ -138,8 +166,9 @@\n         size=\"small\"\r\n         loading={loading}\r\n         pagination={false}\r\n         locale={{ emptyText: \"暂无待上传文件\" }}\r\n+        rowSelection={rowSelection}\r\n       />\r\n     </div>\r\n   );\r\n };\r\n"
                },
                {
                    "date": 1748435518508,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -167,8 +167,9 @@\n         loading={loading}\r\n         pagination={false}\r\n         locale={{ emptyText: \"暂无待上传文件\" }}\r\n         rowSelection={rowSelection}\r\n+        scroll={{ y: 400 }}\r\n       />\r\n     </div>\r\n   );\r\n };\r\n"
                },
                {
                    "date": 1748435793403,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -19,8 +19,9 @@\n }) => {\r\n   const [files, setFiles] = useState<UploadFileMeta[]>([]);\r\n   const [loading, setLoading] = useState(true);\r\n   const [selectedRowKeys, setSelectedRowKeys] = useState<React.Key[]>([]);\r\n+  const [scrollY, setScrollY] = useState(400);\r\n \r\n   const fetchFiles = async () => {\r\n     setLoading(true);\r\n     const all = await getAllFileMeta();\r\n@@ -36,8 +37,21 @@\n   useEffect(() => {\r\n     if (progress === 100) fetchFiles();\r\n   }, [progress]);\r\n \r\n+  useEffect(() => {\r\n+    const calcHeight = () => {\r\n+      // 计算可用高度，300为顶部操作区和边距的估算，可根据实际页面微调\r\n+      const offset = 300;\r\n+      setScrollY(\r\n+        window.innerHeight - offset > 200 ? window.innerHeight - offset : 200\r\n+      );\r\n+    };\r\n+    calcHeight();\r\n+    window.addEventListener(\"resize\", calcHeight);\r\n+    return () => window.removeEventListener(\"resize\", calcHeight);\r\n+  }, []);\r\n+\r\n   // 优化：本地先删，UI立刻响应\r\n   const handleRemove = async (key: string) => {\r\n     setFiles((prev) => prev.filter((item) => item.key !== key));\r\n     await removeFileMeta(key);\r\n@@ -167,9 +181,9 @@\n         loading={loading}\r\n         pagination={false}\r\n         locale={{ emptyText: \"暂无待上传文件\" }}\r\n         rowSelection={rowSelection}\r\n-        scroll={{ y: 400 }}\r\n+        scroll={{ y: scrollY }}\r\n       />\r\n     </div>\r\n   );\r\n };\r\n"
                },
                {
                    "date": 1748435894820,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -101,9 +101,9 @@\n     {\r\n       title: \"大小\",\r\n       dataIndex: \"size\",\r\n       key: \"size\",\r\n-      align: \"left\" as const,\r\n+      align: \"right\" as const,\r\n       render: (size: number) => `${(size / 1024).toFixed(1)} KB`,\r\n     },\r\n     {\r\n       title: \"类型\",\r\n@@ -114,16 +114,16 @@\n     {\r\n       title: \"操作时间\",\r\n       dataIndex: \"addedAt\",\r\n       key: \"addedAt\",\r\n-      align: \"left\" as const,\r\n+      align: \"center\" as const,\r\n       render: (t: number) => new Date(t).toLocaleString(),\r\n     },\r\n     {\r\n       title: \"操作\",\r\n       key: \"action\",\r\n-      align: \"right\" as const,\r\n-      render: (_: unknown, record: UploadFileMeta) => (\r\n+      align: \"center\" as const,\r\n+      render: (_: any, record: UploadFileMeta) => (\r\n         <Button danger size=\"small\" onClick={() => handleRemove(record.key)}>\r\n           删除\r\n         </Button>\r\n       ),\r\n"
                },
                {
                    "date": 1748435948381,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -102,8 +102,9 @@\n       title: \"大小\",\r\n       dataIndex: \"size\",\r\n       key: \"size\",\r\n       align: \"right\" as const,\r\n+      width: 100,\r\n       render: (size: number) => `${(size / 1024).toFixed(1)} KB`,\r\n     },\r\n     {\r\n       title: \"类型\",\r\n@@ -115,14 +116,16 @@\n       title: \"操作时间\",\r\n       dataIndex: \"addedAt\",\r\n       key: \"addedAt\",\r\n       align: \"center\" as const,\r\n+      width: 180,\r\n       render: (t: number) => new Date(t).toLocaleString(),\r\n     },\r\n     {\r\n       title: \"操作\",\r\n       key: \"action\",\r\n       align: \"center\" as const,\r\n+      width: 100,\r\n       render: (_: any, record: UploadFileMeta) => (\r\n         <Button danger size=\"small\" onClick={() => handleRemove(record.key)}>\r\n           删除\r\n         </Button>\r\n"
                },
                {
                    "date": 1748435989003,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -110,8 +110,9 @@\n       title: \"类型\",\r\n       dataIndex: \"type\",\r\n       key: \"type\",\r\n       align: \"left\" as const,\r\n+      width: 120,\r\n     },\r\n     {\r\n       title: \"操作时间\",\r\n       dataIndex: \"addedAt\",\r\n"
                },
                {
                    "date": 1748436016309,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -102,9 +102,9 @@\n       title: \"大小\",\r\n       dataIndex: \"size\",\r\n       key: \"size\",\r\n       align: \"right\" as const,\r\n-      width: 100,\r\n+      width: 120,\r\n       render: (size: number) => `${(size / 1024).toFixed(1)} KB`,\r\n     },\r\n     {\r\n       title: \"类型\",\r\n"
                },
                {
                    "date": 1748436025513,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -102,9 +102,9 @@\n       title: \"大小\",\r\n       dataIndex: \"size\",\r\n       key: \"size\",\r\n       align: \"right\" as const,\r\n-      width: 120,\r\n+      width: 100,\r\n       render: (size: number) => `${(size / 1024).toFixed(1)} KB`,\r\n     },\r\n     {\r\n       title: \"类型\",\r\n"
                },
                {
                    "date": 1748436052915,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -177,8 +177,9 @@\n           </div>\r\n         )}\r\n       </div>\r\n       <Table\r\n+        bordered\r\n         columns={columns}\r\n         dataSource={files}\r\n         rowKey=\"key\"\r\n         size=\"small\"\r\n"
                },
                {
                    "date": 1748436477526,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -103,9 +103,11 @@\n       dataIndex: \"size\",\r\n       key: \"size\",\r\n       align: \"right\" as const,\r\n       width: 100,\r\n-      render: (size: number) => `${(size / 1024).toFixed(1)} KB`,\r\n+      render: (size: number) => (\r\n+        <span style={{ marginRight: 16 }}>{(size / 1024).toFixed(1)} KB</span>\r\n+      ),\r\n     },\r\n     {\r\n       title: \"类型\",\r\n       dataIndex: \"type\",\r\n"
                },
                {
                    "date": 1748436524508,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -104,9 +104,9 @@\n       key: \"size\",\r\n       align: \"right\" as const,\r\n       width: 100,\r\n       render: (size: number) => (\r\n-        <span style={{ marginRight: 16 }}>{(size / 1024).toFixed(1)} KB</span>\r\n+        <span style={{ marginRight: 32 }}>{(size / 1024).toFixed(1)} KB</span>\r\n       ),\r\n     },\r\n     {\r\n       title: \"类型\",\r\n"
                },
                {
                    "date": 1748436530055,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -104,9 +104,9 @@\n       key: \"size\",\r\n       align: \"right\" as const,\r\n       width: 100,\r\n       render: (size: number) => (\r\n-        <span style={{ marginRight: 32 }}>{(size / 1024).toFixed(1)} KB</span>\r\n+        <span style={{ marginRight: 16 }}>{(size / 1024).toFixed(1)} KB</span>\r\n       ),\r\n     },\r\n     {\r\n       title: \"类型\",\r\n"
                },
                {
                    "date": 1748436571459,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -6,8 +6,9 @@\n   removeFileMeta,\r\n } from \"../services/dbService\";\r\n \r\n import type { UploadFileMeta } from \"../types/file\";\r\n+import { formatFileSize } from \"../services/utils\";\r\n \r\n interface FileListPanelProps {\r\n   progress?: number;\r\n   costSeconds?: number;\r\n@@ -104,9 +105,9 @@\n       key: \"size\",\r\n       align: \"right\" as const,\r\n       width: 100,\r\n       render: (size: number) => (\r\n-        <span style={{ marginRight: 16 }}>{(size / 1024).toFixed(1)} KB</span>\r\n+        <span style={{ marginRight: 16 }}>{formatFileSize(size)}</span>\r\n       ),\r\n     },\r\n     {\r\n       title: \"类型\",\r\n"
                },
                {
                    "date": 1748436581959,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -103,9 +103,9 @@\n       title: \"大小\",\r\n       dataIndex: \"size\",\r\n       key: \"size\",\r\n       align: \"right\" as const,\r\n-      width: 100,\r\n+      width: 120,\r\n       render: (size: number) => (\r\n         <span style={{ marginRight: 16 }}>{formatFileSize(size)}</span>\r\n       ),\r\n     },\r\n"
                },
                {
                    "date": 1748443786832,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -13,8 +13,16 @@\n   progress?: number;\r\n   costSeconds?: number;\r\n }\r\n \r\n+// UploadFileMeta 转 File\r\n+function metaToFile(meta: UploadFileMeta): File {\r\n+  return new File([meta.buffer], meta.name, {\r\n+    type: meta.type,\r\n+    lastModified: meta.lastModified,\r\n+  });\r\n+}\r\n+\r\n const FileListPanel: React.FC<FileListPanelProps> = ({\r\n   progress,\r\n   costSeconds,\r\n }) => {\r\n@@ -136,8 +144,18 @@\n       ),\r\n     },\r\n   ];\r\n \r\n+  // 上传选中\r\n+  const handleStartSelected = async () => {\r\n+    for (const key of selectedRowKeys) {\r\n+      const meta = files.find((f) => f.key === key);\r\n+      if (meta) {\r\n+        await handleStartUploadWithAutoMD5(metaToFile(meta));\r\n+      }\r\n+    }\r\n+  };\r\n+\r\n   return (\r\n     <div>\r\n       <div style={{ marginBottom: 8, display: \"flex\", alignItems: \"center\" }}>\r\n         <Button\r\n"
                },
                {
                    "date": 1748443810832,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -7,8 +7,9 @@\n } from \"../services/dbService\";\r\n \r\n import type { UploadFileMeta } from \"../types/file\";\r\n import { formatFileSize } from \"../services/utils\";\r\n+import { useFileUploadQueue } from \"../contexts/FileUploadQueueContext\";\r\n \r\n interface FileListPanelProps {\r\n   progress?: number;\r\n   costSeconds?: number;\r\n@@ -30,8 +31,26 @@\n   const [loading, setLoading] = useState(true);\r\n   const [selectedRowKeys, setSelectedRowKeys] = useState<React.Key[]>([]);\r\n   const [scrollY, setScrollY] = useState(400);\r\n \r\n+  const {\r\n+    md5Info,\r\n+    instantInfo,\r\n+    uploadingInfo,\r\n+    uploadingAll,\r\n+    speedInfo,\r\n+    errorInfo,\r\n+    handleStartAll,\r\n+    handleRetry,\r\n+    handleRetryAllFailed,\r\n+    handleStartUploadWithAutoMD5,\r\n+    calcTotalSpeed,\r\n+  } = useFileUploadQueue({\r\n+    concurrency: 5,\r\n+    chunkSize: 1024 * 1024,\r\n+    apiPrefix: DEFAULT_API_PREFIX,\r\n+  });\r\n+\r\n   const fetchFiles = async () => {\r\n     setLoading(true);\r\n     const all = await getAllFileMeta();\r\n     setFiles(all);\r\n@@ -174,8 +193,16 @@\n           disabled={selectedRowKeys.length === 0}\r\n         >\r\n           批量删除\r\n         </Button>\r\n+        <Button\r\n+          type=\"primary\"\r\n+          style={{ marginLeft: 8 }}\r\n+          onClick={handleStartSelected}\r\n+          disabled={selectedRowKeys.length === 0 || uploadingAll}\r\n+        >\r\n+          上传选中\r\n+        </Button>\r\n         {typeof progress === \"number\" && progress < 100 && (\r\n           <div\r\n             style={{\r\n               marginLeft: 16,\r\n"
                },
                {
                    "date": 1748443825478,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -7,15 +7,17 @@\n } from \"../services/dbService\";\r\n \r\n import type { UploadFileMeta } from \"../types/file\";\r\n import { formatFileSize } from \"../services/utils\";\r\n-import { useFileUploadQueue } from \"../contexts/FileUploadQueueContext\";\r\n+import { useFileUploadQueue } from \"../hooks/useFileUploadQueue\";\r\n \r\n interface FileListPanelProps {\r\n   progress?: number;\r\n   costSeconds?: number;\r\n }\r\n \r\n+const DEFAULT_API_PREFIX = \"http://localhost:3000/api\";\r\n+\r\n // UploadFileMeta 转 File\r\n function metaToFile(meta: UploadFileMeta): File {\r\n   return new File([meta.buffer], meta.name, {\r\n     type: meta.type,\r\n@@ -32,22 +34,11 @@\n   const [selectedRowKeys, setSelectedRowKeys] = useState<React.Key[]>([]);\r\n   const [scrollY, setScrollY] = useState(400);\r\n \r\n   const {\r\n-    md5Info,\r\n-    instantInfo,\r\n-    uploadingInfo,\r\n     uploadingAll,\r\n-    speedInfo,\r\n-    errorInfo,\r\n-    handleStartAll,\r\n-    handleRetry,\r\n-    handleRetryAllFailed,\r\n     handleStartUploadWithAutoMD5,\r\n-    calcTotalSpeed,\r\n   } = useFileUploadQueue({\r\n-    concurrency: 5,\r\n-    chunkSize: 1024 * 1024,\r\n     apiPrefix: DEFAULT_API_PREFIX,\r\n   });\r\n \r\n   const fetchFiles = async () => {\r\n"
                },
                {
                    "date": 1748443842649,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -33,12 +33,9 @@\n   const [loading, setLoading] = useState(true);\r\n   const [selectedRowKeys, setSelectedRowKeys] = useState<React.Key[]>([]);\r\n   const [scrollY, setScrollY] = useState(400);\r\n \r\n-  const {\r\n-    uploadingAll,\r\n-    handleStartUploadWithAutoMD5,\r\n-  } = useFileUploadQueue({\r\n+  const { uploadingAll, handleStartUploadWithAutoMD5 } = useFileUploadQueue({\r\n     apiPrefix: DEFAULT_API_PREFIX,\r\n   });\r\n \r\n   const fetchFiles = async () => {\r\n"
                },
                {
                    "date": 1748443918731,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -142,12 +142,20 @@\n     {\r\n       title: \"操作\",\r\n       key: \"action\",\r\n       align: \"center\" as const,\r\n-      width: 100,\r\n+      width: 120,\r\n       render: (_: any, record: UploadFileMeta) => (\r\n-        <Button danger size=\"small\" onClick={() => handleRemove(record.key)}>\r\n-          删除\r\n+        <Button\r\n+          size=\"small\"\r\n+          type=\"primary\"\r\n+          onClick={() => {\r\n+            console.log('上传文件', record);\r\n+            handleStartUploadWithAutoMD5(metaToFile(record));\r\n+          }}\r\n+          disabled={uploadingAll}\r\n+        >\r\n+          上传文件\r\n         </Button>\r\n       ),\r\n     },\r\n   ];\r\n"
                },
                {
                    "date": 1748443964254,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -142,21 +142,31 @@\n     {\r\n       title: \"操作\",\r\n       key: \"action\",\r\n       align: \"center\" as const,\r\n-      width: 120,\r\n+      width: 160,\r\n       render: (_: any, record: UploadFileMeta) => (\r\n-        <Button\r\n-          size=\"small\"\r\n-          type=\"primary\"\r\n-          onClick={() => {\r\n-            console.log(\"上传文件\", record);\r\n-            handleStartUploadWithAutoMD5(metaToFile(record));\r\n-          }}\r\n-          disabled={uploadingAll}\r\n-        >\r\n-          上传文件\r\n-        </Button>\r\n+        <>\r\n+          <Button\r\n+            size=\"small\"\r\n+            type=\"primary\"\r\n+            onClick={() => {\r\n+              console.log('上传文件', record);\r\n+              handleStartUploadWithAutoMD5(metaToFile(record));\r\n+            }}\r\n+            disabled={uploadingAll}\r\n+            style={{ marginRight: 8 }}\r\n+          >\r\n+            上传文件\r\n+          </Button>\r\n+          <Button\r\n+            danger\r\n+            size=\"small\"\r\n+            onClick={() => handleRemove(record.key)}\r\n+          >\r\n+            删除\r\n+          </Button>\r\n+        </>\r\n       ),\r\n     },\r\n   ];\r\n \r\n"
                },
                {
                    "date": 1748444220259,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -149,9 +149,8 @@\n           <Button\r\n             size=\"small\"\r\n             type=\"primary\"\r\n             onClick={() => {\r\n-              console.log(\"上传文件\", record);\r\n               handleStartUploadWithAutoMD5(metaToFile(record));\r\n             }}\r\n             disabled={uploadingAll}\r\n             style={{ marginRight: 8 }}\r\n"
                }
            ],
            "date": 1748432685733,
            "name": "Commit-0",
            "content": "import { Button, List, Spin, Typography, message } from \"antd\";\r\nimport React, { useEffect, useState } from \"react\";\r\nimport {\r\n  clearAllFileMeta,\r\n  getAllFileMeta,\r\n  removeFileMeta,\r\n} from \"../services/dbService\";\r\n\r\nimport type { UploadFileMeta } from \"../types/file\";\r\n\r\nconst FileListPanel: React.FC = () => {\r\n  const [files, setFiles] = useState<UploadFileMeta[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  const fetchFiles = async () => {\r\n    setLoading(true);\r\n    const all = await getAllFileMeta();\r\n    setFiles(all);\r\n    setLoading(false);\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchFiles();\r\n  }, []);\r\n\r\n  const handleRemove = async (key: string) => {\r\n    await removeFileMeta(key);\r\n    message.success(\"已删除\");\r\n    fetchFiles();\r\n  };\r\n\r\n  const handleClear = async () => {\r\n    await clearAllFileMeta();\r\n    message.success(\"已清空\");\r\n    fetchFiles();\r\n  };\r\n\r\n  return (\r\n    <div>\r\n      <div style={{ marginBottom: 8 }}>\r\n        <Button\r\n          danger\r\n          size=\"small\"\r\n          onClick={handleClear}\r\n          disabled={files.length === 0}\r\n        >\r\n          清空全部\r\n        </Button>\r\n      </div>\r\n      {loading ? (\r\n        <Spin />\r\n      ) : (\r\n        <List\r\n          bordered\r\n          size=\"small\"\r\n          dataSource={files}\r\n          locale={{ emptyText: \"暂无待上传文件\" }}\r\n          renderItem={(item) => (\r\n            <List.Item\r\n              actions={[\r\n                <Button\r\n                  danger\r\n                  size=\"small\"\r\n                  onClick={() => handleRemove(item.key)}\r\n                  key=\"remove\"\r\n                >\r\n                  删除\r\n                </Button>,\r\n              ]}\r\n            >\r\n              <Typography.Text>{item.name}</Typography.Text>\r\n              <span style={{ marginLeft: 8, color: \"#888\" }}>\r\n                {(item.size / 1024).toFixed(1)} KB\r\n              </span>\r\n              <span style={{ marginLeft: 8, color: \"#888\" }}>{item.type}</span>\r\n            </List.Item>\r\n          )}\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default FileListPanel;\r\n"
        }
    ]
}